<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Recipe Tiles – Working Version</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
/* ---------- Layout ---------- */
body{
  font-family:system-ui,Arial,sans-serif;
  background:#f9fafb;
  margin:0;
  padding:1rem;
}
h1{font-size:1.8rem;margin-bottom:1rem;}
h2{font-size:1.4rem;margin:1rem 0 .5rem;color:#333;}
.grid{display:grid;}
.gap-4{gap:1rem;}

/* Responsive grid - simplified */
@media (min-width: 480px) {
  .grid { grid-template-columns: repeat(2, 1fr); }
}
@media (min-width: 768px) {
  .grid { grid-template-columns: repeat(3, 1fr); }
}
@media (min-width: 1024px) {
  .grid { grid-template-columns: repeat(4, 1fr); }
}

/* ---------- Card ---------- */
.recipe-card{
  position:relative;
  border-radius:.5rem;
  overflow:hidden;
  box-shadow:0 2px 6px rgba(0,0,0,.1);
  cursor:pointer;
  transition:transform .15s ease,box-shadow .15s ease;
}
.recipe-card:hover{
  transform:translateY(-2px);
  box-shadow:0 4px 12px rgba(0,0,0,.15);
}
.recipe-card img{
  width:100%;height:180px;object-fit:cover;display:block;
}
.recipe-card .title{
  position:absolute; left:0; right:0; bottom:0;
  background:rgba(0,0,0,.45);color:#fff;padding:.4rem .6rem;
  font-weight:600;
}
.recipe-card.selected::after{
  content:"✔";
  position:absolute;top:.6rem;left:.6rem;
  background:#28a745;color:#fff;
  width:1.6rem;height:1.6rem;border-radius:50%;
  font-size:1rem;line-height:1.6rem;text-align:center;
}
.tile-number{
  position:absolute;
  top:.5rem;right:.5rem;
  color:rgba(255,255,255,0.5);
  font-weight:bold;
  font-size:1.1rem;
  z-index:10;
}

/* ---------- Modal ---------- */
.modal{
  position:fixed;
  top:0; left:0; right:0; bottom:0;
  background:rgba(0,0,0,.4);
  display:flex; align-items:center; justify-content:center;
  visibility:hidden; opacity:0; transition:opacity .2s;
}
.modal.show{visibility:visible; opacity:1;}
.modal .dialog{
  background:#fff; border-radius:.5rem; max-width:90%;
  max-height:90%; overflow:auto; padding:1.5rem; position:relative;
}
.modal .close{
  position:absolute; top:.5rem; right:.5rem;
  background:none; border:none; font-size:1.4rem;
  cursor:pointer; color:#666;
}
.modal h2{margin-top:0;}
.modal ul{margin:0;padding:0;list-style:none;}
.modal li{margin-bottom:.4rem;}

/* ---------- Buttons ---------- */
button{font:inherit;cursor:pointer;}
.btn{display:inline-block;padding:.5rem 1rem;border-radius:.4rem;border:none;}
.btn-primary{background:#28a745;color:#fff;}
.btn-primary:disabled{background:#94d3a2;cursor:not-allowed;}
.btn-secondary{background:#6c757d;color:#fff;}
</style>
</head>
<body>

<h1>Recipe Tiles – Working Version</h1>

<div id="gallery"></div>

<div style="margin-top:1rem;">
  <button id="make-list" class="btn btn-primary" disabled>
    Get Shopping List (<span id="count">0</span>)
  </button>
</div>

<div id="modal" class="modal">
  <div class="dialog">
    <button class="close">&times;</button>
    <h2 id="modal-title"></h2>
    <ul id="modal-body"></ul>
    <div id="modal-actions" style="margin-top:1rem;text-align:right;"></div>
  </div>
</div>

<script>
function roundAmount(unit, amount) {
  if (!unit) return Math.ceil(amount);
  var u = unit.toLowerCase();
  if (u === 'g' || u === 'kg') return Math.ceil(amount / 50) * 50;
  if (u === 'ml' || u === 'l') return Math.ceil(amount / 100) * 100;
  if (u === 'tbsp' || u === 'tsp' || u === 'cup') return Math.ceil(amount);
  return Math.ceil(amount);
}

var recipes = [
  { id:1, title:"Spaghetti Carbonara",
    image:"https://picsum.photos/seed/spaghetti/400/300",
    category:"beef",
    ingredients:[
      {name:"Spaghetti",unit:"g",amount:400},
      {name:"Pancetta",unit:"g",amount:150},
      {name:"Eggs",unit:"",amount:4},
      {name:"Parmesan cheese",unit:"g",amount:100},
      {name:"Black pepper",unit:"tsp",amount:0.5}
    ]
  },
  { id:2, title:"Greek Salad",
    image:"https://picsum.photos/seed/greek/400/300",
    category:"veggie",
    ingredients:[
      {name:"Cucumber",unit:"",amount:1},
      {name:"Tomatoes",unit:"",amount:2},
      {name:"Feta cheese",unit:"g",amount:150},
      {name:"Olives",unit:"",amount:50},
      {name:"Olive oil",unit:"tbsp",amount:2},
      {name:"Oregano",unit:"tsp",amount:0.5}
    ]
  },
  { id:3, title:"Banana Pancakes",
    image:"https://www.cookingclassy.com/wp-content/uploads/2020/04/banana-pancakes-18.jpg,
    category:"veggie",
    ingredients:[
      {name:"Banana",unit:"",amount:2},
      {name:"Flour",unit:"g",amount:120},
      {name:"Milk",unit:"ml",amount:200},
      {name:"Eggs",unit:"",amount:1},
      {name:"Sugar",unit:"tbsp",amount:1}
    ]
  },
  { id:4, title:"Sushi Platter",
    image:"https://picsum.photos/seed/sushi/400/300",
    category:"pork",
    ingredients:[
      {name:"Sushi rice",unit:"g",amount:250},
      {name:"Nori sheets",unit:"pcs",amount:5},
      {name:"Salmon",unit:"g",amount:150},
      {name:"Soy sauce",unit:"tbsp",amount:2},
      {name:"Wasabi",unit:"tsp",amount:0.5}
    ]
  },
  { id:5, title:"Chicken Teriyaki",
    image:"https://th.bing.com/th/id/R.97b1f208c37fc814ab5843df1af1c446?rik=wCWhfT5E2fSO0w&riu=http%3a%2f%2frasamalaysia.com%2fwp-content%2fuploads%2f2016%2f03%2fchicken-teriyaki2.jpg&ehk=Pp09i3x1lSmwfcQ5cmhsSHZak9Pc1QNJlon2ygaRPx4%3d&risl=&pid=ImgRaw&r=0",
    category:"chicken",
    ingredients:[
      {name:"Chicken breast",unit:"g",amount:400},
      {name:"Soy sauce",unit:"tbsp",amount:3},
      {name:"Mirin",unit:"tbsp",amount:2},
      {name:"Sugar",unit:"tbsp",amount:1},
      {name:"Sesame oil",unit:"tbsp",amount:1}
    ]
  },
  { id:6, title:"Beef Stir‑Fry",
    image:"https://picsum.photos/seed/beef/400/300",
    category:"beef",
    ingredients:[
      {name:"Beef strips",unit:"g",amount:300},
      {name:"Broccoli",unit:"g",amount:200},
      {name:"Soy sauce",unit:"tbsp",amount:2},
      {name:"Garlic",unit:"clove",amount:2},
      {name:"Sesame oil",unit:"tbsp",amount:1}
    ]
  },
  { id:7, title:"Veggie Wrap",
    image:"https://picsum.photos/seed/wrap/400/300",
    category:"veggie",
    ingredients:[
      {name:"Tortilla",unit:"pcs",amount:2},
      {name:"Bell pepper",unit:"pcs",amount:1},
      {name:"Avocado",unit:"pcs",amount:1},
      {name:"Lettuce",unit:"g",amount:50},
      {name:"Hummus",unit:"tbsp",amount:2}
    ]
  }
];

var selected = {};
var tileCounter = 1;

var modal = document.getElementById('modal');
var modalTitle = document.getElementById('modal-title');
var modalBody = document.getElementById('modal-body');
var modalActions = document.getElementById('modal-actions');

document.querySelector('.close').onclick = function () {
  modal.className = 'modal';
};
modal.onclick = function (e) {
  if (e.target === modal) { modal.className = 'modal'; }
};

function renderGallery() {
  var container = document.getElementById('gallery');
  container.innerHTML = '';
  tileCounter = 1;

  var categories = { beef: [], chicken: [], pork: [], veggie: [] };
  
  for (var i = 0; i < recipes.length; i++) {
    var r = recipes[i];
    var cat = (r.category || 'veggie').toLowerCase();
    if (!categories[cat]) { categories[cat] = []; }
    categories[cat].push(r);
  }

  for (var cat in categories) {
    if (categories.hasOwnProperty(cat) && categories[cat].length) {
      var section = document.createElement('section');

      var heading = document.createElement('h2');
      heading.textContent = cat.charAt(0).toUpperCase() + cat.slice(1);
      section.appendChild(heading);

      var grid = document.createElement('div');
      grid.className = 'grid gap-4';

      for (var j = 0; j < categories[cat].length; j++) {
        var recipe = categories[cat][j];
        var card = document.createElement('div');
        card.className = 'recipe-card';
        if (selected[recipe.id]) { card.className += ' selected'; }

        card.innerHTML = '<img src="' + recipe.image + '" alt="' + recipe.title + '">' +
                         '<div class="title">' + recipe.title + '</div>';

        var num = document.createElement('span');
        num.className = 'tile-number';
        num.textContent = tileCounter++;
        card.insertBefore(num, card.firstChild);

        (function (r, element) {
          element.onclick = function (e) {
            if (e.shiftKey || e.ctrlKey || e.metaKey) {
              toggleSelect(r.id, element);
            } else {
              openIngredientModal(r);
            }
          };
        })(recipe, card);

        grid.appendChild(card);
      }

      section.appendChild(grid);
      container.appendChild(section);
    }
  }
}

function toggleSelect(id, element) {
  if (selected[id]) {
    delete selected[id];
    element.className = element.className.replace(' selected', '');
  } else {
    selected[id] = true;
    element.className += ' selected';
  }
  document.getElementById('count').textContent = Object.keys(selected).length;
  document.getElementById('make-list').disabled = Object.keys(selected).length === 0;
}

function openIngredientModal(recipe) {
  modalTitle.textContent = recipe.title;
  var html = '';
  for (var i = 0; i < recipe.ingredients.length; i++) {
    var ing = recipe.ingredients[i];
    html += '<li>' + ing.amount + ' ' + ing.unit + ' ' + ing.name + '</li>';
  }
  modalBody.innerHTML = html;
  modalActions.innerHTML = '<button class="btn btn-secondary" id="select-toggle">' +
                          (selected[recipe.id] ? 'Deselect' : 'Select') + '</button>';

  document.getElementById('select-toggle').onclick = function () {
    var cards = document.getElementsByClassName('recipe-card');
    for (var j = 0; j < cards.length; j++) {
      if (cards[j].querySelector('.title').textContent === recipe.title) {
        toggleSelect(recipe.id, cards[j]);
        break;
      }
    }
    this.textContent = selected[recipe.id] ? 'Deselect' : 'Select';
  };

  modal.className = 'modal show';
}

function buildShoppingList() {
  modal.className = 'modal';

  var aggregated = {};

  for (var i = 0; i < recipes.length; i++) {
    var r = recipes[i];
    if (!selected[r.id]) continue;
    for (var j = 0; j < r.ingredients.length; j++) {
      var ing = r.ingredients[j];
      var key = ing.name + '|' + (ing.unit || '');
      if (!aggregated[key]) {
        aggregated[key] = {name: ing.name, unit: ing.unit, amount: 0};
      }
      aggregated[key].amount += ing.amount;
    }
  }

  var list = [];
  for (var key in aggregated) {
    if (aggregated.hasOwnProperty(key)) {
      var item = aggregated[key];
      item.amount = roundAmount(item.unit, item.amount);
      list.push(item);
    }
  }
  list.sort(function (a, b) { return a.name.localeCompare(b.name); });

  modalTitle.textContent = 'Your Shopping List';
  var html = '';
  for (var k = 0; k < list.length; k++) {
    var it = list[k];
    html += '<li>' + it.amount + ' ' + it.unit + ' ' + it.name + '</li>';
  }
  modalBody.innerHTML = html;
  modalActions.innerHTML = '<button class="btn btn-primary" id="copy-list">Copy</button>' +
                          '<button class="btn btn-primary" id="download-list">Download .txt</button>';

  document.getElementById('copy-list').onclick = function () {
    var txt = '';
    for (var m = 0; m < list.length; m++) {
      var it = list[m];
      txt += it.amount + ' ' + it.unit + ' ' + it.name + '\n';
    }
    if (navigator.clipboard) {
      navigator.clipboard.writeText(txt).then(function () { alert('Copied!'); });
    } else {
      alert('Copy not supported. Please copy manually.');
    }
  };

  document.getElementById('download-list').onclick = function () {
    var txt = '';
    for (var n = 0; n < list.length; n++) {
      var it = list[n];
      txt += it.amount + ' ' + it.unit + ' ' + it.name + '\n';
    }
    var blob = new Blob([txt], {type:'text/plain'});
    var a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
    a.download = 'shopping-list.txt';
    a.click();
    URL.revokeObjectURL(a.href);
  };

  modal.className = 'modal show';
}

document.getElementById('make-list').onclick = buildShoppingList;

renderGallery();
</script>
</body>
</html>
