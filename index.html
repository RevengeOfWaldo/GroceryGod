<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
<meta charset="UTF-8">
<title>Grocery God</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
/* ---------- Layout ---------- */
body{
  font-family:system-ui,Arial,sans-serif;
  background:#f9fafb;
  margin:0;
  padding:1rem;
}
h1{font-size:1.8rem;margin-bottom:1rem;text-align:center;color:#28a745;}
h2{font-size:1.4rem;margin:1.5rem 0 .5rem;color:#333;border-bottom:2px solid #eee;padding-bottom:0.25rem;}
.grid{display:grid;}
.gap-4{gap:1rem;}

/* Responsive grid */
@media (min-width: 480px) {
  .grid { grid-template-columns: repeat(2, 1fr); }
}
@media (min-width: 768px) {
  .grid { grid-template-columns: repeat(3, 1fr); }
}
@media (min-width: 1024px) {
  .grid { grid-template-columns: repeat(4, 1fr); }
}

/* ---------- 4. Menu System ---------- */
.menu {
  background-color: #fff;
  border: 1px solid #ddd;
  border-radius: .4rem;
  padding: .5rem;
  margin-bottom: 1.5rem;
  display: flex;
  justify-content: absolute;
  flex-wrap: wrap;
  gap: .5rem;
  box-shadow: 0 1px 3px rgba(0,0,0,.05);
  position: center;
  top: 1rem;
  z-index: 50;
}
.menu a {
  display: inline-block;
  padding: .5rem 1rem;
  border-radius: .4rem;
  border: 1px solid #28a745;
  background: #fff;
  color: #28a745;
  text-decoration: none;
  font-weight: 500;
  transition: all .15s ease;
}
.menu a:hover {
  background: #28a745;
  color: #fff;
}


/* ---------- Card ---------- */
.recipe-card{
  position:relative;
  border-radius:.5rem;
  overflow:hidden;
  box-shadow:0 2px 6px rgba(0,0,0,.1);
  background: #fff;
  transition:transform .15s ease,box-shadow .15s ease;
}
.recipe-card:hover{
  transform:translateY(-2px);
  box-shadow:0 4px 12px rgba(0,0,0,.15);
}
/* 1. Image Modal Trigger */
.recipe-card img{
  width:100%;height:180px;object-fit:cover;display:block;
  cursor: zoom-in; /* Hint that the image is clickable */
}
.recipe-card .card-content {
  padding: .6rem;
  cursor: pointer; /* Hint that the card body is clickable */
}
.recipe-card .title{
  font-weight:600;
  color: #222;
}
.recipe-card.selected::after{
  content:"✔";
  position:absolute;top:.6rem;left:.6rem;
  background:#28a745;color:#fff;
  width:1.6rem;height:1.6rem;border-radius:50%;
  font-size:1rem;line-height:1.6rem;text-align:center;
  z-index: 10;
}
.tile-number{
  position:absolute;
  top:.5rem;right:.5rem;
  color:rgba(0,0,0,0.4);
  background: rgba(255,255,255,0.7);
  border-radius: 50%;
  width: 1.5rem;
  height: 1.5rem;
  line-height: 1.5rem;
  text-align: center;
  font-weight:bold;
  font-size:.9rem;
  z-index:10;
}

/* ---------- Modals ---------- */
.modal{
  position:fixed;
  top:0; left:0; right:0; bottom:0;
  background:rgba(0,0,0,.4);
  display:flex; align-items:center; justify-content:center;
  visibility:hidden; opacity:0; transition:opacity .2s;
  z-index: 100;
}
.modal.show{visibility:visible; opacity:1;}
.modal .dialog{
  background:#fff; border-radius:.5rem; max-width:90%;
  max-height:90%; overflow:auto; padding:1.5rem; position:relative;
  width: 500px;
}
.modal .close{
  position:absolute; top:.5rem; right:.5rem;
  background:none; border:none; font-size:1.4rem;
  cursor:pointer; color:#666; line-height: 1;
}
.modal h2{margin-top:0;}
.modal ul{margin:0;padding:0;list-style:none;}
.modal li{margin-bottom:.4rem;font-size:1.1rem;}

/* Image Modal Styles */
#image-modal .dialog {
  width: auto;
  max-width: 90%;
  max-height: 90%;
  padding: 0.5rem;
}
#image-modal img {
  display: block;
  max-width: 100%;
  max-height: calc(90vh - 2rem); /* Full viewport height minus padding */
  border-radius: .3rem;
}
#image-modal .close {
  top: -1rem; right: -1rem;
  background: #fff;
  color: #333;
  border-radius: 50%;
  width: 2rem;
  height: 2rem;
  font-size: 1.5rem;
  line-height: 2rem;
  text-align: center;
  box-shadow: 0 2px 5px rgba(0,0,0,.2);
}


/* ---------- Buttons ---------- */
button{font:inherit;cursor:pointer;}
.btn{display:inline-block;padding:.5rem 1rem;border-radius:.4rem;border:none;font-weight:500;}
.btn-primary{background:#28a745;color:#fff;}
.btn-primary:disabled{background:#94d3a2;cursor:not-allowed;}
.btn-secondary{background:#6c757d;color:#fff;}

/* ---------- Recipe Links ---------- */
#recipe-links {
  background: #fff;
  border: 1px solid #ddd;
  border-radius: .5rem;
  padding: 1rem 1.5rem 1.5rem;
  margin-top: 2rem;
}
#recipe-links h2 {
  border: none;
  text-align: center;
  margin-top: 0;
}
#recipe-links-list {
  list-style: decimal;
  padding-left: 1.5rem;
  margin: 0;
  column-count: 1;
}
#recipe-links-list li {
  margin-bottom: .5rem;
}
#recipe-links-list a {
  color: #28a745;
  text-decoration: none;
  font-weight: 500;
}
#recipe-links-list a:hover {
  text-decoration: underline;
}
@media (min-width: 480px) {
  #recipe-links-list { column-count: 2; }
}
@media (min-width: 768px) {
  #recipe-links-list { column-count: 3; }
}

</style>
</head>
<body>

<h1>Fix Your Grocery List!</h1>

<nav class="menu">
  <a href="#section-beef">Beef</a>
  <a href="#section-chicken">Chicken</a>
  <a href="#section-pork">Pork</a>
  <a href="#section-veggie">Veggie</a>
  <a href="#section-fast/easy">Fast/Easy</a>

</nav>

<div id="gallery"></div>

<div style="margin-top:1.5rem;">
  <button id="make-list" class="btn btn-primary" disabled>
    Get Shopping List (<span id="count">0</span>)
  </button>
</div>

<!-- Ingredient Modal -->
<div id="modal" class="modal">
  <div class="dialog">
    <button class="close">&times;</button>
    <h2 id="modal-title"></h2>
    <!-- Image added to ingredient modal -->
    <img id="modal-image" src="" alt="" style="width:100%; height:auto; max-height: 200px; object-fit: cover; border-radius: 0.3rem; margin-bottom: 1rem;">
    <ul id="modal-body"></ul>
    <div id="modal-actions" style="margin-top:1rem;text-align:right;"></div>
  </div>
</div>

<!-- Image Modal -->
<div id="image-modal" class="modal">
  <div class="dialog">
    <button class="close">&times;</button>
    <img id="image-modal-src" src="" alt="Full-size recipe image">
  </div>
</div>

<!-- Recipe Links -->
<section id="recipe-links">
  <h2>Recipe Links</h2>
  <ol id="recipe-links-list"></ol>
</section>


<script>
function roundAmount(unit, amount) {
  if (!unit) return Math.ceil(amount);
  var u = unit.toLowerCase();
  if (u === 'g' || u === 'kg') return Math.ceil(amount / 50) * 50;
  if (u === 'ml' || u === 'l') return Math.ceil(amount / 100) * 100;
  if (u === 'tbsp' || u === 'tsp' || u === 'cup') return Math.ceil(amount);
  return Math.ceil(amount);
}

var recipes = [
  { id:1, title:"Spaghetti Carbonara",
    image:"https://picsum.photos/seed/spaghetti/600/400",
    category:"beef",
    ingredients:[
      {name:"Spaghetti",unit:"g",amount:400},
      {name:"Pancetta",unit:"g",amount:150},
      {name:"Eggs",unit:"",amount:4},
      {name:"Parmesan cheese",unit:"g",amount:100},
      {name:"Black pepper",unit:"tsp",amount:0.5}
    ]
  },
  { id:2, title:"Greek Salad",
    image:"https://picsum.photos/seed/greek/600/400",
    category:"veggie",
    ingredients:[
      {name:"Cucumber",unit:"",amount:1},
      {name:"Tomatoes",unit:"",amount:2},
      {name:"Feta cheese",unit:"g",amount:150},
      {name:"Olives",unit:"",amount:50},
      {name:"Olive oil",unit:"tbsp",amount:2},
      {name:"Oregano",unit:"tsp",amount:0.5}
    ]
  },
  { id:3, title:"Banana Pancakes", 
   category:"veggie",
   image:"banana-pancakes.jpg", // Fixed broken image
    ingredients:[
      {name:"Banana",unit:"",amount:2},
      {name:"Flour",unit:"g",amount:120},
      {name:"Milk",unit:"ml",amount:200},
      {name:"Eggs",unit:"",amount:1},
      {name:"Sugar",unit:"tbsp",amount:1}
    ]
  },
  { id:4, title:"Sushi Platter",
    image:"https://picsum.photos/seed/sushi/600/400",
    category:"pork",
    ingredients:[
      {name:"Sushi rice",unit:"g",amount:250},
      {name:"Nori sheets",unit:"pcs",amount:5},
      {name:"Salmon",unit:"g",amount:150},
      {name:"Soy sauce",unit:"tbsp",amount:2},
      {name:"Wasabi",unit:"tsp",amount:0.5}
    ]
  },
  { id:5, title:"Chicken Teriyaki",
    image: "https://placehold.co/600x400/E85A4F/FFF?text=Chicken+Teriyaki", // Added placeholder
    category: "chicken", // Added category
    ingredients:[
      {name:"Chicken breast",unit:"g",amount:400},
      {name:"Soy sauce",unit:"tbsp",amount:3},
      {name:"Mirin",unit:"tbsp",amount:2},
      {name:"Sugar",unit:"tbsp",amount:1},
      {name:"Sesame oil",unit:"tbsp",amount:1}
    ]
  },
  { id:6, title:"Beef Stir‑Fry",
    image:"https://picsum.photos/seed/beef/600/400",
    category:"beef",
    ingredients:[
      {name:"Beef strips",unit:"g",amount:300},
      {name:"Broccoli",unit:"g",amount:200},
      {name:"Soy sauce",unit:"tbsp",amount:2},
      {name:"Garlic",unit:"clove",amount:2},
      {name:"Sesame oil",unit:"tbsp",amount:1}
    ]
  },
  { id:7, title:"Veggie Wrap",
    image:"https://picsum.photos/seed/wrap/600/400",
    category:"veggie",
    ingredients:[
      {name:"Tortilla",unit:"pcs",amount:2},
      {name:"Bell pepper",unit:"pcs",amount:1},
      {name:"Avocado",unit:"pcs",amount:1},
      {name:"Lettuce",unit:"g",amount:50},
      {name:"Hummus",unit:"tbsp",amount:2}
    ]
  }
];

var selected = {};
var tileCounter = 1;

// Ingredient Modal
var modal = document.getElementById('modal');
var modalTitle = document.getElementById('modal-title');
var modalImage = document.getElementById('modal-image'); // Get modal image element
var modalBody = document.getElementById('modal-body');
var modalActions = document.getElementById('modal-actions');

document.querySelector('#modal .close').onclick = function () {
  modal.className = 'modal';
};
modal.onclick = function (e) {
  if (e.target === modal) { modal.className = 'modal'; }
};

// --- Image Modal Logic ---
var imageModal = document.getElementById('image-modal');
var imageModalSrc = document.getElementById('image-modal-src');

document.querySelector('#image-modal .close').onclick = function () {
  imageModal.className = 'modal';
};
imageModal.onclick = function (e) {
  if (e.target === imageModal) { imageModal.className = 'modal'; }
};

function openImageModal(recipe) {
  imageModalSrc.src = recipe.image;
  imageModalSrc.alt = recipe.title;
  imageModal.className = 'modal show';
}
// --- End Image Modal Logic ---


function renderGallery() {
  var container = document.getElementById('gallery');
  container.innerHTML = '';
  tileCounter = 1;

  var categories = { beef: [], chicken: [], pork: [], veggie: [], fast: [] };[] };
  
  for (var i = 0; i < recipes.length; i++) {
    var r = recipes[i];
    var cat = (r.category || 'veggie').toLowerCase();
    if (!categories[cat]) { categories[cat] = []; }
    categories[cat].push(r);
  }

  for (var cat in categories) {
    if (categories.hasOwnProperty(cat) && categories[cat].length) {
      var section = document.createElement('section');
      section.id = 'section-' + cat; // 4. Add ID for menu anchor

      var heading = document.createElement('h2');
      heading.textContent = cat.charAt(0).toUpperCase() + cat.slice(1);
      section.appendChild(heading);

      var grid = document.createElement('div');
      grid.className = 'grid gap-4';

      for (var j = 0; j < categories[cat].length; j++) {
        var recipe = categories[cat][j];
        var card = document.createElement('div');
        card.id = 'recipe-' + recipe.id; // 2. Add ID for recipe link
        card.className = 'recipe-card';
        if (selected[recipe.id]) { card.className += ' selected'; }

        // Add onerror handler for robust image loading
        var imgHtml = '<img src="' + recipe.image + '" alt="' + recipe.title + '" ' +
                      'onerror="this.src=\'https://placehold.co/600x400/ccc/999?text=Image+Not+Found\'; this.onerror=null;">';

        card.innerHTML = imgHtml +
                         '<div class="card-content">' +
                           '<div class="title">' + recipe.title + '</div>' +
                         '</div>';

        var num = document.createElement('span');
        num.className = 'tile-number';
        num.textContent = tileCounter++;
        card.insertBefore(num, card.firstChild);

        (function (r, element) {
          // 1. Image click listener
          var imgEl = element.querySelector('img');
          imgEl.onclick = function(e) {
            e.stopPropagation(); // Stop click from bubbling to card
            openImageModal(r);
          };

          // Card content click listener (for ingredients)
          var contentEl = element.querySelector('.card-content');
          contentEl.onclick = function (e) {
            if (e.shiftKey || e.ctrlKey || e.metaKey) {
              toggleSelect(r.id, element);
            } else {
              openIngredientModal(r);
            }
          };
        })(recipe, card);

        grid.appendChild(card);
      }

      section.appendChild(grid);
      container.appendChild(section);
    }
  }
}

// Render Recipe Links
function renderRecipeLinks() {
  var list = document.getElementById('recipe-links-list');
  list.innerHTML = ''; // Clear existing
  for (var i = 0; i < recipes.length; i++) {
    var r = recipes[i];
    var li = document.createElement('li');
    li.innerHTML = '<a href="#recipe-' + r.id + '">' + r.title + '</a>';
    list.appendChild(li);
  }
}

function toggleSelect(id, element) {
  if (selected[id]) {
    delete selected[id];
    element.className = element.className.replace(' selected', '');
  } else {
    selected[id] = true;
    element.className += ' selected';
  }
  document.getElementById('count').textContent = Object.keys(selected).length;
  document.getElementById('make-list').disabled = Object.keys(selected).length === 0;
}

function openIngredientModal(recipe) {
  modalTitle.textContent = recipe.title;
  
  // Set image source and alt for ingredient modal
  modalImage.src = recipe.image;
  modalImage.alt = recipe.title;
  modalImage.onerror = function() { 
    this.src='https://placehold.co/600x400/ccc/999?text=Image+Not+Found'; 
    this.onerror=null; 
  };

  var html = '';
  for (var i = 0; i < recipe.ingredients.length; i++) {
    var ing = recipe.ingredients[i];
    html += '<li>' + ing.amount + ' ' + (ing.unit || '') + ' ' + ing.name + '</li>';
  }
  modalBody.innerHTML = html;
  modalActions.innerHTML = '<button class="btn btn-secondary" id="select-toggle">' +
                          (selected[recipe.id] ? 'Deselect' : 'Select') + '</button>';

  document.getElementById('select-toggle').onclick = function () {
    var card = document.getElementById('recipe-' + recipe.id);
    if (card) {
      toggleSelect(recipe.id, card);
    }
    this.textContent = selected[recipe.id] ? 'Deselect' : 'Select';
  };

  modal.className = 'modal show';
}

function buildShoppingList() {
  modal.className = 'modal'; // Hide any open modal first

  var aggregated = {};

  for (var i = 0; i < recipes.length; i++) {
    var r = recipes[i];
    if (!selected[r.id]) continue;
    for (var j = 0; j < r.ingredients.length; j++) {
      var ing = r.ingredients[j];
      var key = ing.name.toLowerCase() + '|' + (ing.unit || '').toLowerCase();
      if (!aggregated[key]) {
        aggregated[key] = {name: ing.name, unit: ing.unit, amount: 0};
      }
      aggregated[key].amount += ing.amount;
    }
  }

  var list = [];
  for (var key in aggregated) {
    if (aggregated.hasOwnProperty(key)) {
      var item = aggregated[key];
      item.amount = roundAmount(item.unit, item.amount);
      list.push(item);
    }
  }
  list.sort(function (a, b) { return a.name.localeCompare(b.name); });

  modalTitle.textContent = 'Your Shopping List';
  modalImage.src = ""; // Hide image in shopping list modal
  modalImage.alt = "";
  modalImage.style.display = "none"; // Hide the image element
  
  var html = '';
  for (var k = 0; k < list.length; k++) {
    var it = list[k];
    html += '<li>' + it.amount + ' ' + (it.unit || '') + ' ' + it.name + '</li>';
  }
  modalBody.innerHTML = html;
  modalActions.innerHTML = '<button class="btn btn-primary" id="copy-list">Copy</button>' +
                          '<button class="btn btn-primary" id="download-list" style="margin-left: 0.5rem">Download .txt</button>';

  document.getElementById('copy-list').onclick = function () {
    var txt = 'Grocery God Shopping List:\n\n';
    for (var m = 0; m < list.length; m++) {
      var it = list[m];
      txt += it.amount + ' ' + (it.unit || '') + ' ' + it.name + '\n';
    }
    
    try {
      navigator.clipboard.writeText(txt).then(function () {
        var copyBtn = document.getElementById('copy-list');
        var originalText = copyBtn.textContent;
        copyBtn.textContent = 'Copied!';
        copyBtn.disabled = true;
        setTimeout(function() {
           copyBtn.textContent = originalText;
           copyBtn.disabled = false;
        }, 2000);
      });
    } catch (err) {
      console.error('Failed to copy list: ', err);
      try {
        var textArea = document.createElement("textarea");
        textArea.value = txt;
        document.body.appendChild(textArea);
        textArea.focus();
        textArea.select();
        document.execCommand('copy');
        document.body.removeChild(textArea);
        
        var copyBtn = document.getElementById('copy-list');
        var originalText = copyBtn.textContent;
        copyBtn.textContent = 'Copied!';
        copyBtn.disabled = true;
        setTimeout(function() {
           copyBtn.textContent = originalText;
           copyBtn.disabled = false;
        }, 2000);
        
      } catch (fallbackErr) {
         console.error('Fallback copy failed: ', fallbackErr);
      }
    }
  };

  document.getElementById('download-list').onclick = function () {
    var txt = 'Grocery God Shopping List:\n\n';
    for (var n = 0; n < list.length; n++) {
      var it = list[n];
      txt += it.amount + ' ' + (it.unit || '') + ' ' + it.name + '\n';
    }
    var blob = new Blob([txt], {type:'text/plain;charset=utf-8'});
    var a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'shopping-list.txt';
    document.body.appendChild(a); // Required for Firefox
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(a.href);
  };

  modal.className = 'modal show';
  
  // Need to re-show the image element for next time
  modal.querySelector('.close').onclick = function () {
    modal.className = 'modal';
    modalImage.style.display = ""; // Reset display property
  };
  modal.onclick = function (e) {
    if (e.target === modal) { 
      modal.className = 'modal'; 
      modalImage.style.display = ""; // Reset display property
    }
  };
}

document.getElementById('make-list').onclick = buildShoppingList;

// Initial render
renderGallery();
renderRecipeLinks();
</script>
</body>
</html>


